<!DOCTYPE html>
<html>
    <head>
		<meta charset="UTF-8">
		<title>Masymbol</title>
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		
		<link rel="shortcut icon" href="favicon.ico" />
		
		<!-- bootstrap framework -->
		<link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		
		<!-- custom icons -->
			<!-- font awesome icons -->
			<link href="assets/icons/font-awesome/css/font-awesome.min.css" rel="stylesheet" media="screen">
			<!-- ionicons -->	
			<link href="assets/icons/ionicons/css/ionicons.min.css" rel="stylesheet" media="screen">
			<!-- flags -->
			<link rel="stylesheet" href="assets/icons/flags/flags.css">
				
	
	<!-- page specific stylesheets -->

		<!-- nvd3 charts -->
		<link rel="stylesheet" href="assets/lib/novus-nvd3/nv.d3.min.css">
		<!-- owl carousel -->
		<link rel="stylesheet" href="assets/lib/owl-carousel/owl.carousel.css">
				
		<!-- main stylesheet -->
		<link href="assets/css/style.css" rel="stylesheet" media="screen">
		
		<!-- Load c3.css -->
		<link href="stylesheets/c3.css" rel="stylesheet" type="text/css">

		<!-- Load style.css -->
		<link href="stylesheets/style.css" rel="stylesheet" type="text/css">
		
		<!-- google webfonts -->
		<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400&amp;subset=latin-ext,latin' rel='stylesheet' type='text/css'>		

		<!-- jQuery -->
		<script src="assets/js/jquery.min.js"></script>
		
		<!-- moment.js (date library) -->
		<script src="assets/lib/moment-js/moment.min.js"></script>
		
		<!-- Load d3.js and c3.js -->
		<script src="javascripts/d3.min.js"></script>
		<script src="javascripts/c3.min.js"></script>
		<script type="text/javascript" src="javascripts/jquery-csv.js"></script>
		<script type="text/javascript" src="javascripts/script.js"></script>
    </head>
    <body>
		<!-- top bar -->
		<header class="navbar navbar-fixed-top" role="banner">
			<div class="container-fluid">
				<div class="navbar-header">
					<a href="dashboard.html" class="navbar-brand"><img src="assets/img/blank.gif" alt="Logo"></a>
				</div>			
				<ul class="nav navbar-nav navbar-right">				
				<% if ((Object.keys(req).length > 1) && (Object.keys(req.session).length > 1 ) && (req.session.loggedIn == true)) { %>
				  <li class="user_menu"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><span class="navbar_el_icon ion-person"></span><span class="caret"></span></a>
    				<ul class="dropdown-menu dropdown-menu-right">
      				<li><a href="#">Profile
          				<li><a href="#">My messages</a></li>
          				<li><a href="#">My tasks</a></li>
          				<li class="divider"></li>
          				<li><a href='/logout'>Log Out</a></li>
    				</ul>
  				</li>
  				<% } else { %>
  				<li><a href="/login" style="border:none;" class="btn btn-mini btn-sign-in">Login</a></li>
				<li><a href="/register" style="border:none;" class="btn btn-mini btn-sign-up">Register</a></li>
  				<% } %>
				</ul>
			</div>
			<div class="messages main_wrapper">
				<% if (message && message.length > 1) { %>
  					<div class="alerterror"><%= message %><b><%= searchQuery %></b></div>
  				<% } %>
			</div>
		</header>
		
		<!-- main content -->
		<div id="main_wrapper">
			<div class="page_content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<div class="panel panel-default">
								<div class="panel-body search-container">
                 					<h2>Dashboard</h2>
                 					<form method="POST" action="/google_search"> 
										<input type="text" name="search" id="search-text"> 
										<input type="submit" value="Search" class="btn btn-primary btn-sm" id="btn_search_submit">
									</form>
								</div>
							</div>
						</div>
					</div>				

					<div class="row">

						<% include timeline_graph %>

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Top Posts</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_top_posts" class="chart" style="width:100%">		
													<div id="posts">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Source</b></span>
																	<span class="top-post-text"><b>Text</b></span>
																</a>
															</span>
														<div class="list-group" id="posts-list-group">
															
    												</div>
													</div>
													<script>
														var allTextLines;
														var images = '';														
														$.ajax({
													    url: "<%= disp_data.post_csv %>",
													    aync: false,
													    success: function (csvd) {
													    	var data = $.csv.toObjects(csvd);
													    	console.log(data);
													    	data.map(function(d)
													    	{
													    		if(d["text"]){
														    		var source_image;
														    		if(d["Source"] == "Twitter"){
														    			source_image = "<span class='ion-social-twitter social-icons new-social-twitter'></span>";
														    		}else if(d["Source"] == "G+"){
														    			source_image = "<span class='ion-icon-social-google-plus social-icons new-social-google-plus'></span>";
														    		} else{
														    			source_image = "<span class='ion-image social-icons'></span>"
														    		}

														    		$('#posts-list-group').append('<span class="single-row"><a href="#" class="list-group-item">'+source_image+'<span class="top-post-text">'+d["text"]+'</span></span>');
																	}
													    	});
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Word Cloud</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social__wordcloud" class="chart" style="width:100%; height: 321px;">	
    										<img src="<%= disp_data.wordcloud_image %>" alt="wordcloud" style="width:100%; height: 330px;"/>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Sentiment Graphs</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social_sentiment">											
    										
											</div>
											<script type="text/javascript">
												var positive = [];
												var negative = [];
												var neutral = [];
												d3.csv("<%= disp_data.sentiment_graph %>", function(tests)
												{
													data = tests.map(function(d)
													{
														if (d.analysis_score == 0){
															neutral.push(d.analysis_score);
														}else if (d.analysis_score>=1){
															positive.push(d.analysis_score);
														}else if (d.analysis_score<0){
															negative.push(d.analysis_score);
														}
													})
													var pos = ['Positive', positive.length];
													var neg = ['Negative', negative.length];
													var neu = ['Neutral', neutral.length];
													console.log("pos"+pos+"neg"+neg+"neu"+neu);
													var chart = c3.generate({
	    											bindto: '#flot_social_sentiment',
	    											data: {
	      												columns: [
	            											pos,
	            											neg,
	            											neu,
	        											],
	        											type : 'donut',
	        											onclick: function (d, i) { console.log("onclick", d, i); },
	        											onmouseover: function (d, i) { console.log("onmouseover", d, i); },
	        											onmouseout: function (d, i) { console.log("onmouseout", d, i); }
	    											},
														legend: {
    														position: 'right'
														},
	    											donut: {
	    												title: "Sentiment Score"
	    											}
													});
												})  	
  	
  										</script>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>					

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Some Positives</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_some_pos" class="chart" style="width:100%">		
													<div id="some_pos">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Some Positive Comments</b></span>
																</a>
															</span>
														<div class="list-group" id="some-pos-list-group"></div>
													</div>
													<script>
														$.ajax({
													    url: "<%= disp_data.some_positive_csv %>",
													    aync: false,
													    success: function (csvd) {
																var data = $.csv.toObjects(csvd);
													    	data.map(function(d)
													    	{
													    		if(d["x"]){
													    			$('#some-pos-list-group').append("<span class='single-row'><a href='#'class='list-group-item'><span class='top-post-text'>"+d["x"]+"</span></a></span>");				
													    		}														
													    	});
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Some Negatives</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_some_negatives" class="chart" style="width:100%">		
													<div id="some_negatives">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Some Negative Comments</b></span>
																</a>
															</span>
														<div class="list-group" id="some_negatives-list-group"></div>
													</div>
													<script>
														$.ajax({
													    url: "<%= disp_data.some_negative_csv %>",
													    aync: false,
													    success: function (csvd) {
																var data = $.csv.toObjects(csvd);
													    	data.map(function(d)
													    	{
													    		if(d["x"]){
													    			$('#some_negatives-list-group').append("<span class='single-row'><a href='#'class='list-group-item'><span class='top-post-text'>"+d["x"]+"</span></a></span>");	
													    		}																	
													    	});
													    },
													    dataType: "text"
														});

													</script>	

												</div>
											</div>
										</div>
								</div>
							</div>
						</div>
					</div>					

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Recent Users</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social_recent_user" class="chart" style="width:100%">		
												<div id="recent_users"></div>
												<script>
													var allTextLines;
													var images = '';
													$.ajax({
													    url: "<%= disp_data.users_csv %>",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);
													      console.log(allTextLines[3].toString().split(",")[2]);
															if(allTextLines.length > 30){
																for(i = 0; i < 30; i++){
																	$('#recent_users').append('<div class="col-md-2"><a href='+allTextLines[i].toString().split(",")[2]+'><img src='+allTextLines[i].toString().split(",")[1]+' alt='+allTextLines[i].toString().split(",")[0]+'></img></a></div>')
																}
													    }
													     if(allTextLines.length <= 30){
													    	jQuery.each(allTextLines, function(i, val) {
													      console.log("i: "+i+" => Value: "+val);
													      if(val){
													      	$('#recent_users').append('<div class="col-md-2"><a href='+val.toString().split(",")[2]+'><img src='+val.toString().split(",")[1]+' alt='+val.toString().split(",")[0]+'></img></a></div>')
													    }
													    });
													    }										    

													    },
													    dataType: "text"
													});

												</script>											
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

							<div class="col-md-6">
								<div class="panel panel-default">
									<div class="panel-body">
										<div class="heading_b">Most Influencers</div>
										<div class="row">
											<div class="col-md-12">
												<div id="flot_social_most_influencers" class="chart" style="width:100%">		
													<div id="most_influencers"></div>
													<script>
														var allTextLines;
														var images = '';
														$.ajax({
													    url: "<%= disp_data.influencers_csv %>",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);

																if(allTextLines.length > 30){
																	for(i = 0; i < 30; i++){
																		$('#most_influencers').append('<div class="col-md-2"><a href='+allTextLines[i].toString().split(",")[2]+'><img src='+allTextLines[i].toString().split(",")[0]+' alt='+allTextLines[i].toString().split(",")[1]+'></img></a></div>');
																	}
																}
																if(allTextLines.length <= 30){
																	jQuery.each(allTextLines, function(i, val) {
													      		console.log("i: "+i+" => Value: "+val);
													      		if(val){
													      		$('#most_influencers').append('<div class="col-md-2"><a href='+val.toString().split(",")[2]+'><img src='+val.toString().split(",")[0]+' alt='+val.toString().split(",")[1]+'></img></a></div>')
													    			}
													    		});
																}
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
					</div>

					<div class="row">

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
                 					<div class="heading_b">Geo Location</div>
                 					<script src="http://d3js.org/d3.v3.min.js"></script>
									<script src="http://d3js.org/topojson.v0.min.js"></script>
									<div id="world_map" style="border: 1px solid black;"></div>
									<script>
									var width = 960,
									    height = 500;

									var projection = d3.geo.mercator()
									    .center([0, 5 ])
									    .scale(200)
									    .rotate([-180,0]);

									var svg = d3.select("#world_map").append("svg")
									    .attr("width", width)
									    .attr("height", height);

									var path = d3.geo.path()
									    .projection(projection);

									var g = svg.append("g");

									// load and display the World
									d3.json("json/world-110m2.json", function(error, topology) {

									// load and display the cities
									d3.csv("<%= disp_data.geo_location_csv %>", function(error, data) {
									    g.selectAll("circle")
									       .data(data)
									       .enter()
									       .append("circle")
									       .attr("cx", function(d) {
									       		//console.log("d.lon+d.lat"+d.V1+" == "+d.V2);
									               return projection([d.V2, d.V1])[0];
									       })
									       .attr("cy", function(d) {
									               return projection([d.V2, d.V1])[1];
									       })
									       .attr("r", 5)
									       .style("fill", "red");
									});


									g.selectAll("path")
									      .data(topojson.object(topology, topology.objects.countries)
									          .geometries)
									    .enter()
									      .append("path")
									      .attr("d", path)
									});

									// zoom and pan
									var zoom = d3.behavior.zoom()
									    .on("zoom",function() {
									        g.attr("transform","translate("+ 
									            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
									        g.selectAll("circle")
									            .attr("d", path.projection(projection));
									        g.selectAll("path")  
									            .attr("d", path.projection(projection)); 

									  });

									svg.call(zoom)

									</script>
								</div>
							</div>
						</div>

					</div>

				</div>
			</div>		
		</div>

		<!-- side navigation -->
		<nav id="side_nav">
			<ul>
				<li>
					<a href="/"><span class="ion-speedometer"></span> <span class="nav_title">Dashboard</span></a>
				</li>				
			</ul>
		</nav>

		<!-- easing -->
		<script src="assets/js/jquery.easing.1.3.min.js"></script>
		<!-- bootstrap js plugins -->
		<script src="assets/bootstrap/js/bootstrap.min.js"></script>
		<!-- top dropdown navigation -->
		<script src="assets/js/tinynav.js"></script>
		<!-- perfect scrollbar -->
		<script src="assets/lib/perfect-scrollbar/min/perfect-scrollbar-0.4.8.with-mousewheel.min.js"></script>
		
		<!-- common functions -->
		<script src="assets/js/tisa_common.js"></script>
		
		<!-- style switcher -->
		<script src="assets/js/tisa_style_switcher.js"></script>
		
    </body>
</html>