<!DOCTYPE html>
<html>
    <head>
		<meta charset="UTF-8">
		<title>Masymbol</title>
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		
		<link rel="shortcut icon" href="favicon.ico" />
		
		<!-- bootstrap framework -->
		<link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		
		<!-- custom icons -->
			<!-- font awesome icons -->
			<link href="assets/icons/font-awesome/css/font-awesome.min.css" rel="stylesheet" media="screen">
			<!-- ionicons -->	
			<link href="assets/icons/ionicons/css/ionicons.min.css" rel="stylesheet" media="screen">
			<!-- flags -->
			<link rel="stylesheet" href="assets/icons/flags/flags.css">
				
	
	<!-- page specific stylesheets -->

		<!-- nvd3 charts -->
		<link rel="stylesheet" href="assets/lib/novus-nvd3/nv.d3.min.css">
		<!-- owl carousel -->
		<link rel="stylesheet" href="assets/lib/owl-carousel/owl.carousel.css">
				
		<!-- main stylesheet -->
		<link href="assets/css/style.css" rel="stylesheet" media="screen">
		
		<!-- Load c3.css -->
		<link href="stylesheets/c3.css" rel="stylesheet" type="text/css">
		
		<!-- google webfonts -->
		<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400&amp;subset=latin-ext,latin' rel='stylesheet' type='text/css'>
		

		<!-- jQuery -->
		<script src="assets/js/jquery.min.js"></script>
		
		<!-- moment.js (date library) -->
		<script src="assets/lib/moment-js/moment.min.js"></script>
		
		<!-- Load d3.js and c3.js -->
		<script src="javascripts/d3.min.js"></script>
		<script src="javascripts/c3.min.js"></script>
		<script type="text/javascript" src="javascripts/jquery-csv.js"></script>
		<style>
			#recent_users img, #most_influencers img{
				border: 2px solid black;
				margin: 2px;
			}
			#posts-list-group{
				max-height: 322px;
				overflow: scroll;
			}

			/* Styles for Posts */
			span.single-row {
    		display: table;
    		width: 100%;
			}
			span.single-row span {
			  float: none;
			  display: table-cell;
			  vertical-align: top;
			}
			span.top-post-source, span.social-icons{
				padding-right: 10px;
			}

			/*styles for social icons colors */
			span.new-social-google-plus{
				color:red;
			}
			span.new-social-twitter{
				color: #4D94FF;
			}

			/* Timeline css */
			text.shadow {
			  stroke: #fff;
			  stroke-width: 2.5px;
			  opacity: 0.9;
			}

			path { 
			    stroke: steelblue;
			    stroke-width: 2;
			    fill: none;
			}

			.axis path,
			.axis line {
			    fill: none;
			    stroke: grey;
			    stroke-width: 1;
			    shape-rendering: crispEdges;
			}

			.grid .tick {
			    stroke: lightgrey;
			    stroke-opacity: 0.7;
			    shape-rendering: crispEdges;
			}
			.grid path {
			          stroke-width: 0;
			}

			.area {
			    fill: lightsteelblue;
			      stroke-width: 0;
			}

		</style>
    </head>
    <body>
		<!-- top bar -->
		<header class="navbar navbar-fixed-top" role="banner">
			<div class="container-fluid">
				<div class="navbar-header">
					<a href="dashboard.html" class="navbar-brand"><img src="assets/img/blank.gif" alt="Logo"></a>
				</div>			
				<ul class="nav navbar-nav navbar-right">				
				<% if ((Object.keys(req).length > 1) && (Object.keys(req.session).length > 1 ) && (req.session.loggedIn == true)) { %>
				  <li class="user_menu"><a href="#" data-toggle="dropdown" class="dropdown-toggle"><span class="navbar_el_icon ion-person"></span><span class="caret"></span></a>
    				<ul class="dropdown-menu dropdown-menu-right">
      				<li><a href="#">Profile
          				<li><a href="#">My messages</a></li>
          				<li><a href="#">My tasks</a></li>
          				<li class="divider"></li>
          				<li><a href='/logout'>Log Out</a></li>
    				</ul>
  				</li>
  				<% } else { %>
  				<li><a href="/login" style="border:none;" class="btn btn-mini btn-sign-in">Login</a></li>
				<li><a href="/register" style="border:none;" class="btn btn-mini btn-sign-up">Register</a></li>
  				<% } %>
				</ul>
			</div>
			<div class="messages main_wrapper">
				<% if (message && message.length > 1) { %>
  					<div class="alerterror"><%= message %><b><%= searchQuery %></b></div>
  				<% } %>
			</div>
		</header>
		
		<!-- main content -->
		<div id="main_wrapper">
			<div class="page_content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<div class="panel panel-default">
								<div class="panel-body">
                 	<h2>Dashboard</h2>
                 	<form method="POST" action="/google_search"> 
										<input type="text" name="search"> 
										<input type="submit" value="Search">
									</form> 
								</div>
							</div>
						</div>
					</div>				

					<div class="row">

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Timeline</div>
									<div class="row">										
										<div class="col-md-12">
											<div id="flot_browsers" class="chart" style="width:100%">
												<div id="timeline"></div>
												<script>

												var margin = {top: 30, right: 20, bottom: 35, left: 50},
												  //width = 600 - margin.left - margin.right,
												  //height = 400 - margin.top - margin.bottom;
												  width=300
												  height=300

												var parseDate = d3.time.format("%d-%b-%y").parse;

												var x = d3.time.scale().range([0, width]);
												var y = d3.scale.linear().range([height, 0]);

												var xAxis = d3.svg.axis()
												    .scale(x)
												    .orient("bottom")
												    .ticks(5);

												var yAxis = d3.svg.axis()
												    .scale(y)
												    .orient("left")
												    .ticks(5);

												var area = d3.svg.area()
												    .x(function(d) { return x(d.date); })
												    .y0(height)
												    .y1(function(d) { return y(d.close); });

												var valueline = d3.svg.line()
												    .x(function(d) { return x(d.date); })
												    .y(function(d) { return y(d.close); });
												    
												var svg = d3.select("#timeline")
												    .append("svg")
												        .attr("width", width + margin.left + margin.right)
												        .attr("height", 275)
												    .append("g")
												        .attr("transform", 
												              "translate(" + margin.left + "," + margin.top + ")");

												// function for the x grid lines
												function make_x_axis() {
												    return d3.svg.axis()
												        .scale(x)
												        .orient("bottom")
												        .ticks(5)
												}

												// function for the y grid lines
												function make_y_axis() {
												  return d3.svg.axis()
												      .scale(y)
												      .orient("left")
												      .ticks(5)
												}

												// Get the data
												d3.csv("sample_timeline_data.csv", function(error, data) {
												    data.forEach(function(d) {
												        d.date = parseDate(d.date);
												        d.close = +d.close;
												    });

												    // Scale the range of the data
												    x.domain(d3.extent(data, function(d) { return d.date; }));
												    y.domain([0, d3.max(data, function(d) { return d.close; })]);

												    // Add the filled area
												    svg.append("path")
												        .datum(data)
												        .attr("class", "area")
												        .attr("d", area);

												    // Draw the x Grid lines
												    svg.append("g")
												        .attr("class", "grid")
												        .attr("transform", "translate(0," + height + ")")
												        .call(make_x_axis()
												            .tickSize(-height, 0, 0)
												            .tickFormat("")
												        )

												    // Draw the y Grid lines
												    svg.append("g")            
												        .attr("class", "grid")
												        .call(make_y_axis()
												            .tickSize(-width, 0, 0)
												            .tickFormat("")
												        )

												    // Add the valueline path.
												    svg.append("path")
												        .attr("d", valueline(data));

												    // Add the X Axis
												    svg.append("g")
												        .attr("class", "x axis")
												        .attr("transform", "translate(0," + height + ")")
												        .call(xAxis);

												    // Add the Y Axis
												    svg.append("g")
												        .attr("class", "y axis")
												        .call(yAxis);

												    // Add the text label for the X axis
												    svg.append("text")
												        .attr("transform",
												              "translate(" + (width/2) + " ," + 
												                             (height+margin.bottom) + ")")
												        .style("text-anchor", "middle")
												        .text("Date");

												    // Add the white background to the y axis label for legibility
												    /*svg.append("text")
												        .attr("transform", "rotate(-90)")
												        .attr("y", -45)
												        .attr("x", margin.top - (height / 2))
												        .attr("dy", ".71em")
												        .style("text-anchor", "end")
												        .attr("class", "shadow")
												        .text("Price");*/

												    // Add the text label for the Y axis
												    svg.append("text")
												        .attr("transform", "rotate(-90)")
												        .attr("y", -45)
												        .attr("x", margin.top - (height / 2))
												        .attr("dy", ".71em")
												        .style("text-anchor", "end")
												        .text("Price");

												    // Add the title
												    /*svg.append("text")
												        .attr("x", (width / 2))     
												        .attr("y", 0 - (margin.top / 2))
												        .attr("text-anchor", "middle")
												        .style("font-size", "16px")
												        .style("text-decoration", "underline")
												        .text("Price vs Date Graph");*/

												});

												</script>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Top Posts</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_top_posts" class="chart" style="width:100%">		
													<div id="posts">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Source</b></span>
																	<span class="top-post-text"><b>Text</b></span>
																</a>
															</span>
														<div class="list-group" id="posts-list-group">
															
    												</div>
													</div>
													<script>
														var allTextLines;
														var images = '';														
														$.ajax({
													    url: "<%= disp_data.post_csv %>",
													    aync: false,
													    success: function (csvd) {
													    	var data = $.csv.toObjects(csvd);
													    	console.log(data);
													    	data.map(function(d)
													    	{
													    		var source_image;
													    		if(d["Source"] == "Twitter"){
													    			source_image = "<span class='ion-social-twitter social-icons new-social-twitter'></span>";
													    		}else if(d["Source"] == "G+"){
													    			source_image = "<span class='ion-icon-social-google-plus social-icons new-social-google-plus'></span>";
													    		} else{
													    			source_image = "<span class='ion-image social-icons'></span>"
													    		}

													    		$('#posts-list-group').append('<span class="single-row"><a href="#" class="list-group-item">'+source_image+'<span class="top-post-text">'+d["text"]+'</span></span>');
																		
													    	});
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>

					</div>

					<!--<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Most Positive</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_most_pos" class="chart" style="width:100%">		
													<div id="most_pos">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Score</b></span>
																	<span class="top-post-text"><b>Text</b></span>
																</a>
															</span>
														<div class="list-group" id="most-pos-list-group">
															
    												</div>
													</div>
													<script>
														var allTextLines;
														var images = '';
														$.ajax({
													    url: "most_pos.csv",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);

																if(allTextLines.length > 20){
																	for(i = 1; i < 10; i++){
																		$('#most-pos-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source">'+allTextLines[i].split(",")[0]+'</span><span class="top-post-text">'+allTextLines[i].split(",")[1]+'</span></span>');
																	}
																}
																if(allTextLines.length <= 20){
																	jQuery.each(allTextLines, function(i, val) {
													      		console.log("i: "+i+" => Value: "+val);
													      		if(val){
													      			$('#most-pos-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source>'+val.split(",")[0]+'</span><span class="top-post-text">'+val.split(",")[1]+'</span></span>');
													    			}
													    		});
																}
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Most Negatives</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_most_negatives" class="chart" style="width:100%">		
													<div id="most_negatives">
														<span class="single-row-fixed">
																<a href="#" class="list-group-item">
																	<span class="top-post-source"><b>Score</b></span>
																	<span class="top-post-text"><b>Text</b></span>
																</a>
															</span>
														<div class="list-group" id="most_negatives-list-group">
															
    												</div>
													</div>
													<script>
														var allTextLines;
														var images = '';
														$.ajax({
													    url: "most_neg.csv",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);

																if(allTextLines.length > 20){
																	for(i = 1; i < 10; i++){
																		$('#most_negatives-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source">'+allTextLines[i].split(",")[0]+'</span><span class="top-post-text">'+allTextLines[i].split(",")[1]+'</span></span>');
																	}
																}
																if(allTextLines.length <= 20){
																	jQuery.each(allTextLines, function(i, val) {
													      		console.log("i: "+i+" => Value: "+val);
													      		if(val){
													      			$('#most_negatives-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source>'+val.split(",")[0]+'</span><span class="top-post-text">'+val.split(",")[1]+'</span></span>');
													    			}
													    		});
																}
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>

					</div>-->

					<!--<div class="row">
						<div class="col-md-12">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Total Data</div>
									<div class="row">
											<div class="col-md-12">
												<div id="flot_social_total_data" class="chart" style="width:100%">		
													<div id="total_data">
														<!--<span class="single-row-fixed1">-->
																<!--<a href="#" class="list-group-item1">-->
																<!--<table>
																	<span class="top-post-source"><b>ScreenName</b></span>
																	<span class="top-post-source"><b>Twitter Text</b></span>
																	<span class="top-post-source"><b>Followers</b></span>
																	<span class="top-post-source"><b>Retweet Count</b></span>
																	<span class="top-post-source"><b>Long</b></span>
																	<span class="top-post-text"><b>Lat</b></span>
																<!--</a>-->
															<!--</span>-->
														<!--<div class="list-group" id="total_data-list-group">
															
    												</div>
													</div>
													<script>
														var allTextLines;
														var images = '';
														$.ajax({
													    url: "pawankalyan.csv",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);

																/*if(allTextLines.length > 20){
																	for(i = 1; i < 10; i++){
																		$('#total_data-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source">'+allTextLines[i].split(",")[3]+'</span><span class="top-post-source">'+allTextLines[i].split(",")[0]+'</span><span class="top-post-source">'+allTextLines[i].split(",")[5]+'</span><span class="top-post-source">'+allTextLines[i].split(",")[7]+'</span><span class="top-post-source">'+allTextLines[i].split(",")[8]+'</span><span class="top-post-text">'+allTextLines[i].split(",")[9]+'</span></span>');
																	}
																}*/
																//if(allTextLines.length <= 20){
																	jQuery.each(allTextLines, function(i, val) {
													      		console.log("i: "+i+" => Value: "+val);
													      		//if(val){
													      			//$('#total_data-list-group').append('<span class="single-row"><a href="#" class="list-group-item"><span class="top-post-source>'+val.toString().split(",")[0]+'</span><span class="top-post-text">'+val.toString().split(",")[1]+'</span></span>');
													      			$('#total_data-list-group').append("<span class='single-row'><a href='#' class='list-group-item'><span class='top-post-source'>"+i+"==> "+val.split(",")[3]+"</span><span class='top-post-source'>"+val.split(",")[0]+"</span><span class='top-post-source'>"+val.split(",")[5]+"</span><span class='top-post-source'>"+val.split(",")[7]+"</span><span class='top-post-source'>"+val.split(",")[8]+"</span><span class='top-post-text'>"+val.split(",")[9]+"</span></span>");
													    			//}
													    		});
																//}
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
								</div>
							</div>
						</div>					

					</div>-->

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Word Cloud</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social__wordcloud" class="chart" style="width:100%; height: 321px;">		
    										<img src="<%= disp_data.wordcloud_image %>" alt="wordcloud" style="width:100%; height: 330px;"/>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Sentiment Graphs</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social_sentiment">											
    										
											</div>
											<script type="text/javascript">
												var positive = [];
												var negative = [];
												var neutral = [];
												d3.csv("<%= disp_data.sentiment_graph %>", function(tests)
												{
													data = tests.map(function(d)
													{
														if (d.analysis_score == 0){
															neutral.push(d.analysis_score);
														}else if (d.analysis_score>=1){
															positive.push(d.analysis_score);
														}else if (d.analysis_score<0){
															negative.push(d.analysis_score);
														}
													})
													var pos = ['Positive', positive.length];
													var neg = ['Negative', negative.length];
													var neu = ['Neutral', neutral.length];
													console.log("pos"+pos+"neg"+neg+"neu"+neu);
													var chart = c3.generate({
	    											bindto: '#flot_social_sentiment',
	    											data: {
	      												columns: [
	            											pos,
	            											neg,
	            											neu,
	        											],
	        											type : 'donut',
	        											onclick: function (d, i) { console.log("onclick", d, i); },
	        											onmouseover: function (d, i) { console.log("onmouseover", d, i); },
	        											onmouseout: function (d, i) { console.log("onmouseout", d, i); }
	    											},
														legend: {
    														position: 'right'
														},
	    											donut: {
	    												title: "Sentiment Score"
	    											}
													});
												})  	
  	
  										</script>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-default">
								<div class="panel-body">
									<div class="heading_b">Recent Users</div>
									<div class="row">
										<div class="col-md-12">
											<div id="flot_social_recent_user" class="chart" style="width:100%">		
												<div id="recent_users"></div>
												<script>
													var allTextLines;
													var images = '';
													$.ajax({
													    url: "<%= disp_data.users_csv %>",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);
													      console.log(allTextLines[3].toString().split(",")[2]);
															if(allTextLines.length > 30){
															for(i = 0; i < 30; i++){
																$('#recent_users').append('<div class="col-md-2"><a href='+allTextLines[i].toString().split(",")[2]+'><img src='+allTextLines[i].toString().split(",")[1]+' alt='+allTextLines[i].toString().split(",")[0]+'></img></a></div>')
															}
													    }
													     if(allTextLines.length <= 30){
													    	jQuery.each(allTextLines, function(i, val) {
													      console.log("i: "+i+" => Value: "+val);
													      if(val){
													      $('#recent_users').append('<div class="col-md-2"><a href='+val.toString().split(",")[2]+'><img src='+val.toString().split(",")[1]+' alt='+val.toString().split(",")[0]+'></img></a></div>')
													    }
													    });
													    }										    

													    },
													    dataType: "text"
													});

												</script>											
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

							<div class="col-md-6">
								<div class="panel panel-default">
									<div class="panel-body">
										<div class="heading_b">Most Influencers</div>
										<div class="row">
											<div class="col-md-12">
												<div id="flot_social_most_influencers" class="chart" style="width:100%">		
													<div id="most_influencers"></div>
													<script>
														var allTextLines;
														var images = '';
														$.ajax({
													    url: "<%= disp_data.influencers_csv %>",
													    aync: false,
													    success: function (csvd) {
													      console.log(csvd.length);
													      allTextLines = csvd.split(/\r\n|\n/);

																if(allTextLines.length > 30){
																	for(i = 0; i < 30; i++){
																		$('#most_influencers').append('<div class="col-md-2"><a href='+allTextLines[i].toString().split(",")[2]+'><img src='+allTextLines[i].toString().split(",")[0]+' alt='+allTextLines[i].toString().split(",")[1]+'></img></a></div>');
																	}
																}
																if(allTextLines.length <= 30){
																	jQuery.each(allTextLines, function(i, val) {
													      		console.log("i: "+i+" => Value: "+val);
													      		if(val){
													      		$('#most_influencers').append('<div class="col-md-2"><a href='+val.toString().split(",")[2]+'><img src='+val.toString().split(",")[0]+' alt='+val.toString().split(",")[1]+'></img></a></div>')
													    			}
													    		});
																}
													    },
													    dataType: "text"
														});

													</script>											
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

					</div>

					

				</div>
			</div>		
		</div>

		<!-- side navigation -->
		<nav id="side_nav">
			<ul>
				<li>
					<a href="/"><span class="ion-speedometer"></span> <span class="nav_title">Dashboard</span></a>
				</li>				
			</ul>
		</nav>

		
		<!-- easing -->
		<script src="assets/js/jquery.easing.1.3.min.js"></script>
		<!-- bootstrap js plugins -->
		<script src="assets/bootstrap/js/bootstrap.min.js"></script>
		<!-- top dropdown navigation -->
		<script src="assets/js/tinynav.js"></script>
		<!-- perfect scrollbar -->
		<script src="assets/lib/perfect-scrollbar/min/perfect-scrollbar-0.4.8.with-mousewheel.min.js"></script>
		
		<!-- common functions -->
		<script src="assets/js/tisa_common.js"></script>
		
		<!-- style switcher -->
		<script src="assets/js/tisa_style_switcher.js"></script>
		
	<!-- page specific plugins -->

		<!-- nvd3 charts -->
		<script src="assets/lib/d3/d3.min.js"></script>
		<script src="assets/lib/novus-nvd3/nv.d3.min.js"></script>
		<!-- flot charts-->
		<script src="assets/lib/flot/jquery.flot.min.js"></script>
		<script src="assets/lib/flot/jquery.flot.pie.min.js"></script>
		<script src="assets/lib/flot/jquery.flot.resize.min.js"></script>
		<script src="assets/lib/flot/jquery.flot.tooltip.min.js"></script>
		<!-- clndr -->
		<script src="assets/lib/underscore-js/underscore-min.js"></script>
		<script src="assets/lib/CLNDR/src/clndr.js"></script>
		<!-- easy pie chart -->
		<script src="assets/lib/easy-pie-chart/dist/jquery.easypiechart.min.js"></script>
		<!-- owl carousel -->
		<script src="assets/lib/owl-carousel/owl.carousel.min.js"></script>
		
    </body>
</html>